{% extends "base.html" %}

{% block content %}

<div class="dashboard-header">
    <div>
        <h1 class="page-title">üìä Dashboard Overview</h1>
        <p class="subtitle">Welcome back! Here's what's happening today.</p>
    </div>
    
    <!-- QUICK ACTIONS -->
    <div class="quick-actions">
        <a href="{{ url_for('tasks') }}" class="action-btn tasks-btn">
            üìù Tasks
        </a>
        <a href="{{ url_for('budgets') }}" class="action-btn budgets-btn">
            üí∞ Budget
        </a>
    </div>
</div>

<!-- DATE RANGE FILTER -->
<div class="filter-section">
    <span class="filter-label">üìÖ Time Period:</span>
    <div class="filter-buttons">
        <a href="{{ url_for('dashboard', date_range='today') }}" class="filter-btn {{ 'active' if date_range == 'today' else '' }}">Today</a>
        <a href="{{ url_for('dashboard', date_range='week') }}" class="filter-btn {{ 'active' if date_range == 'week' else '' }}">Week</a>
        <a href="{{ url_for('dashboard', date_range='month') }}" class="filter-btn {{ 'active' if date_range == 'month' else '' }}">Month</a>
        <a href="{{ url_for('dashboard', date_range='all') }}" class="filter-btn {{ 'active' if date_range == 'all' else '' }}">All Time</a>
    </div>
</div>

<!-- TASK SUMMARY SECTION -->
<div class="section-container">
    <h2 class="section-title">üìã Task Overview</h2>
    <div class="summary-section">
        <div class="summary-card tasks-card">
            <div class="card-icon">üìù</div>
            <div class="card-content">
                <div class="label">Total Tasks</div>
                <div class="value">{{ total_tasks }}</div>
            </div>
        </div>

        <div class="summary-card completed-card">
            <div class="card-icon">‚úÖ</div>
            <div class="card-content">
                <div class="label">Completed</div>
                <div class="value">{{ completed_tasks }}</div>
            </div>
        </div>

        <div class="summary-card pending-card">
            <div class="card-icon">‚è≥</div>
            <div class="card-content">
                <div class="label">Pending</div>
                <div class="value">{{ pending_tasks }}</div>
            </div>
        </div>

        <div class="summary-card overdue-card">
            <div class="card-icon">üî•</div>
            <div class="card-content">
                <div class="label">Overdue</div>
                <div class="value">{{ overdue_tasks }}</div>
            </div>
        </div>
    </div>
</div>

<!-- FINANCE SUMMARY SECTION -->
<div class="section-container">
    <h2 class="section-title">üí∞ Financial Overview</h2>
    <div class="summary-section">
        <div class="summary-card income-card">
            <div class="card-icon">üíµ</div>
            <div class="card-content">
                <div class="label">Total Income</div>
                <div class="value">
                    {{ '$' if currency=='USD' else '‚Çπ' }}{{ '%.2f'|format(total_income) }}
                </div>
            </div>
        </div>

        <div class="summary-card expense-card">
            <div class="card-icon">üí∏</div>
            <div class="card-content">
                <div class="label">Total Expenses</div>
                <div class="value">
                    {{ '$' if currency=='USD' else '‚Çπ' }}{{ '%.2f'|format(total_expense) }}
                </div>
            </div>
        </div>

        <div class="summary-card balance-card">
            <div class="card-icon">üí∞</div>
            <div class="card-content">
                <div class="label">Balance</div>
                <div class="value {{ 'positive' if balance >= 0 else 'negative' }}">
                    {{ '$' if currency=='USD' else '‚Çπ' }}{{ '%.2f'|format(balance) }}
                </div>
            </div>
        </div>
    </div>
</div>


<!-- CHARTS SECTION -->
<div class="section-container">
    <h2 class="section-title">üìà Visual Analytics</h2>
    <div class="charts-wrapper">
        <!-- TASK PIE -->
        <div class="chart-box">
            <h3 class="chart-heading">üìä Task Distribution</h3>
            <canvas id="taskChart"></canvas>
        </div>

        <!-- FINANCE BAR -->
        <div class="chart-box">
            <h3 class="chart-heading">üíπ Income vs Expenses</h3>
            <canvas id="financeChart"></canvas>
        </div>
    </div>
</div>


<!-- TASKS DUE SOON -->
<div class="section-container">
    <h2 class="section-title">‚è∞ Tasks Due in Next 24 Hours</h2>
    <div class="due-card">
        {% if due_soon %}
            <ul class="task-list">
            {% for t in due_soon %}
                <li class="task-item">
                    <div class="task-info">
                        <div class="task-title">{{ t.title }}</div>
                        <div class="task-desc">{{ t.description or 'No description' }}</div>
                    </div>
                    <div class="task-meta">
                        <div class="task-due">üìÖ {{ t.deadline.strftime('%b %d, %I:%M %p') }}</div>
                        <span class="badge urgent">Due Soon</span>
                    </div>
                </li>
            {% endfor %}
            </ul>
        {% else %}
            <div class="empty">
                <div class="empty-icon">üéâ</div>
                <p>No tasks due within 24 hours</p>
                <small>You're all caught up!</small>
            </div>
        {% endif %}
    </div>
</div>

{% endblock %}


{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>

/* Dashboard Header */
.dashboard-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    gap: 20px;
    flex-wrap: wrap;
}

.page-title {
    font-size: 36px;
    font-weight: 800;
    margin: 0;
    color: #111827;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.subtitle {
    color: #6b7280;
    font-size: 16px;
    margin-top: 5px;
}

/* Quick Actions */
.quick-actions {
    display: flex;
    gap: 12px;
}

.action-btn {
    padding: 12px 24px;
    border-radius: 10px;
    font-size: 16px;
    font-weight: 600;
    text-decoration: none;
    color: white;
    transition: all 0.3s;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.tasks-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.tasks-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
}

.budgets-btn {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
}

.budgets-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(240, 147, 251, 0.4);
}

/* Filter Section */
.filter-section {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 30px;
    flex-wrap: wrap;
}

.filter-label {
    font-weight: 600;
    color: #374151;
    font-size: 15px;
}

.filter-buttons {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.filter-btn {
    padding: 10px 20px;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 600;
    font-size: 14px;
    background: white;
    color: #6b7280;
    border: 2px solid #e5e7eb;
    transition: all 0.2s;
}

.filter-btn:hover {
    border-color: #667eea;
    color: #667eea;
    transform: translateY(-1px);
}

.filter-btn.active {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-color: #667eea;
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

/* Section Container */
.section-container {
    margin-bottom: 35px;
}

/* Summary Cards */
.summary-section {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 25px;
}

.summary-card {
    background: white;
    border-radius: 16px;
    padding: 24px;
    display: flex;
    align-items: center;
    gap: 16px;
    box-shadow: 0 4px 16px rgba(0,0,0,0.08);
    transition: all 0.3s;
    border: 2px solid transparent;
}

.summary-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(0,0,0,0.12);
}

.card-icon {
    font-size: 40px;
    line-height: 1;
}

.card-content {
    flex: 1;
}

.summary-card .label {
    color: #6b7280;
    font-weight: 600;
    font-size: 14px;
    margin-bottom: 4px;
}

.summary-card .value {
    font-size: 28px;
    font-weight: 800;
    color: #111827;
}

/* Card Color Variations */
.tasks-card { border-color: #e0e7ff; background: linear-gradient(135deg, #ffffff 0%, #f0f4ff 100%); }
.completed-card { border-color: #d1fae5; background: linear-gradient(135deg, #ffffff 0%, #ecfdf5 100%); }
.pending-card { border-color: #fef3c7; background: linear-gradient(135deg, #ffffff 0%, #fffbeb 100%); }
.overdue-card { border-color: #fee2e2; background: linear-gradient(135deg, #ffffff 0%, #fef2f2 100%); }
.income-card { border-color: #d1fae5; background: linear-gradient(135deg, #ffffff 0%, #ecfdf5 100%); }
.expense-card { border-color: #fecaca; background: linear-gradient(135deg, #ffffff 0%, #fef2f2 100%); }
.balance-card { border-color: #ddd6fe; background: linear-gradient(135deg, #ffffff 0%, #f5f3ff 100%); }

.value.positive { color: #059669; }
.value.negative { color: #dc2626; }

/* Section Titles */
.section-title {
    margin-bottom: 20px;
    font-size: 22px;
    font-weight: 700;
    color: #111827;
    display: flex;
    align-items: center;
    gap: 8px;
}

/* Charts Layout */
.charts-wrapper {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 24px;
}

.chart-box {
    background: white;
    border-radius: 16px;
    padding: 28px;
    box-shadow: 0 4px 16px rgba(0,0,0,0.08);
    border: 2px solid #f3f4f6;
    transition: all 0.3s;
}

.chart-box:hover {
    border-color: #e5e7eb;
    box-shadow: 0 8px 24px rgba(0,0,0,0.12);
}

.chart-heading {
    font-size: 18px;
    margin-bottom: 20px;
    font-weight: 700;
    color: #111827;
    display: flex;
    align-items: center;
    gap: 8px;
}

/* Due soon card */
.due-card {
    background: white;
    padding: 24px;
    border-radius: 16px;
    border: 2px solid #fef3c7;
    box-shadow: 0 4px 16px rgba(0,0,0,0.08);
}

.task-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.task-item {
    padding: 18px;
    border-bottom: 2px solid #f3f4f6;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 20px;
    transition: all 0.2s;
}

.task-item:last-child {
    border-bottom: none;
}

.task-item:hover {
    background: #fafafa;
    border-radius: 8px;
}

.task-info {
    flex: 1;
}

.task-title {
    font-size: 17px;
    font-weight: 700;
    color: #111827;
    margin-bottom: 4px;
}

.task-desc {
    color: #6b7280;
    font-size: 14px;
}

.task-meta {
    text-align: right;
    display: flex;
    flex-direction: column;
    gap: 8px;
    align-items: flex-end;
}

.task-due {
    font-size: 14px;
    color: #374151;
    font-weight: 500;
}

.badge {
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 700;
    display: inline-block;
}

.badge.urgent {
    background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
    color: white;
}

.empty {
    text-align: center;
    padding: 40px 20px;
}

.empty-icon {
    font-size: 64px;
    margin-bottom: 16px;
}

.empty p {
    font-size: 18px;
    color: #111827;
    font-weight: 600;
    margin-bottom: 8px;
}

.empty small {
    color: #6b7280;
    font-size: 14px;
}

/* Responsive */
@media(max-width: 768px){
    .dashboard-header {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .page-title {
        font-size: 28px;
    }
    
    .quick-actions {
        width: 100%;
    }
    
    .action-btn {
        flex: 1;
    }
    
    .charts-wrapper {
        grid-template-columns: 1fr;
    }
    
    .summary-section {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    }
    
    .task-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
    }
    
    .task-meta {
        align-items: flex-start;
        text-align: left;
    }
}

@media(max-width: 480px){
    .summary-section {
        grid-template-columns: 1fr;
    }
    
    .filter-section {
        flex-direction: column;
        align-items: flex-start;
    }
}

</style>

<script>
const taskData = {{ task_chart_data | tojson }};
const financeData = {{ finance_chart_data | tojson }};

/* TASK PIE */
new Chart(document.getElementById('taskChart'), {
    type: 'pie',
    data: {
        labels: taskData.labels,
        datasets: [{
            data: taskData.values,
            // Pending (yellow), Completed (blue), Overdue (red)
            backgroundColor: ['#facc15', '#2563eb', '#ef4444']
        }]
    },
    options:{
        plugins: { legend:{ position:'bottom' } },
        responsive:true
    }
});

/* FINANCE BAR */
new Chart(document.getElementById('financeChart'), {
    type: 'bar',
    data: {
        labels: financeData.labels,
        datasets: [{
            data: financeData.values,
            // Income (blue), Expenses (red)
            backgroundColor: ['#2563eb', '#ef4444'],
            borderRadius: 12,
            borderSkipped: false
        }]
    },
    options:{
        plugins:{ legend:{ display:false } },
        responsive:true,
        scales:{ y:{ beginAtZero:true } }
    }
});
</script>

{% endblock %}
